<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <link rel="icon" href="img/eslogo196.png">
   <link rel="stylesheet" type="text/css" href="style.css">
   <link rel="stylesheet" href="highlight/matlab.css">
   <script src="highlight/highlight.pack.js"></script>
   <script>hljs.initHighlightingOnLoad();</script>
   <title>stochtraj_diffusion</title>
</head>

<body>

<header>
<ul>
<li><img src="img/eslogo42.png">
<li class="header-title">EasySpin
<li><a href="index.html">Documentation</a>
<li><a href="references.html">Publications</a>
<li><a href="http://easyspin.org" target="_blank">Website</a>
<li><a href="http://easyspin.org/forum" target="_blank">Forum</a>
</ul>
</header>

<section>

<div class="functitle">stochtraj_diffusion</div>

<p>
Simulation of stochastic rotational trajectories.
</p>

<!-- =================================================================== -->
<div class="subtitle">Syntax</div>

<pre class="matlab">
stochtraj_diffusion(Sys)
stochtraj_diffusion(Sys,Par)
stochtraj_diffusion(Sys,Par,Opt)
[t,RTraj] = stochtraj_diffusion(...)
[t,RTraj,qTraj] = stochtraj_diffusion(...)
</pre>

<!-- =================================================================== -->
<div class="subtitle">Description</div>

<p>
<code>stochtraj_diffusion</code> computes stochastic trajectories of rotational diffusion using orientational quaternions.
</p>

<p>
<code>stochtraj_diffusion</code> accepts up to three input arguments

<ul>
<li><code>Sys</code>: dynamic properties
<li><code>Par</code>: (optional) simulation parameters for monte carlo integrator and trajectories
<li><code>Opt</code>: (optional) simulation options
</ul>

<p>
If no input argument is given, a short help summary is shown (same as when typing <code>help stochtraj_diffusion</code>).
</p>

<p>
Up to three output arguments are returned:
<ul>
<li><code>t</code>: time axis, in seconds
<li><code>RTraj</code>: rotation matrices
<li><code>qTraj</code>: quaternions
</ul>

<p>
If no output argument is given, <code>stochtraj_diffusion</code> plots one of the trajectories.
</p>

<div class="subtitle2">Input: System dynamics </div>

<p>
<code>Sys</code> is a structure containing the dynamic properties for generating the stochastic trajectories. Many of its fields overlap with those of <code>chili</code>. This allows the user to easily simulate EPR spectra in both frequency and time domains for comparison.
</p>
For the timescale(s) of motion, one of the fields <code>tcorr</code>, <code>logtcorr</code>, <code>Diff</code> or <code>logDiff</code> should be given. If more than one of these is given, the first in the list <code>logtcorr</code>, <code>tcorr</code>, <code>logDiff</code>, <code>Diff</code> takes precedence over the other(s).
</p>


<div class="optionfield"><code>tcorr</code></div>
<div class="optiondescr">
Rotational correlation time, in seconds.
<ul>
<li>1 number: isotopic diffusion
<li>2 numbers <code>[txy tz]</code>: anisotropic diffusion with axial diffusion tensor
<li>3 numbers <code>[tx ty tz]</code>: anisotropic diffusion with rhombic diffusion tensor
</ul>

<p>For example,
<pre class="matlab">
Sys.tcorr = 1e-9;         % isotropic diffusion, 1ns correlation time
Sys.tcorr = [5 1]*1e-9;   % axial anisotropic diffusion, 5ns around x and y axes, 1ns around z
Sys.tcorr = [5 4 1]*1e-9; % rhombic anisotropic diffusion
</pre>
  
<p>
Instead of <code>tcorr</code>, <code>Diff</code> can be used, see below. If <code>tcorr</code> is given, <code>Diff</code> is ignored. The correlation time <code>tcorr</code> and the diffusion rate <code>Diff</code> are related by <code>tcorr = 1/(6*Diff)</code>.
<br>
</div>

<div class="optionfield"><code>logtcorr</code></div>
<div class="optiondescr">
Base-10 logarithm of the correlation time, offering an alternative way to input the correlation time. If given, <code>tcorr</code>, <code>logDiff</code> and <code>Diff</code> are ignored.<br>
Use this instead of <code>tcorr</code> for least-squares fitting with <a class="esf" href="esfit.html">esfit</a>.
</div>

<div class="optionfield"><code>Diff</code></div>
<div class="optiondescr">
Rotational diffusion rates (principal values of the rotational diffusion tensor), in seconds<sup>-1</sup>.
  <ul>
  <li>one number: isotopic diffusion tensor
  <li>two numbers: input <code>[Dxy Dzz]</code> gives axial tensor <code>[Dxy Dxy Dzz]</code>
  <li>three numbers: rhombic tensor <code>[Dxy Dxy Dzz]</code>
  </ul>
  <code>Diff</code> is ignored if <code>logtcorr</code>, <code>tcorr</code> or <code>logDiff</code> is given.
</div>
  
<div class="optionfield"><code>logDiff</code></div>
<div class="optiondescr">
Base-10 logarithm of <code>Diff</code>. If given, <code>Diff</code> is ignored.
</div>

<p>
It is also possible to specify an orienting potential energy function to simulate restricted rotational diffusion. <code>stochtraj_diffusion</code> accomplishes this by representing the orienting potential function using either a series of Wigner D-functions (see reference for details) or a numerical array. To take advantage of this feature, the user should declare the structure <code>Sys.Potential</code> with fields being either: 
<ul>
<li>each term in the orienting potential by specifying the real and imaginary parts of the coefficients using <code>lambda</code> and the indices corresponding to each term using <code>LMK</code>, or
<li>a numerical array <code>PseudoPotFun</code> representing the potential energy function directly.
</ul>

If these fields are left blank, unrestricted diffusion will be simulated.
</p>

<div class="optionfield"><code>lambda</code></div>
<div class="optiondescr">
An array of size (N,2) containing the orienting potential coefficients, where N corresponds to the number of terms in the orienting potential function, and the first and second entries in the second dimension correspond to the real and imaginary parts of &lambda;<sup>L</sup><sub>M,K</sub> (the symbols c and &epsilon; are used in the literature as well). The full form of the ordering potential is expressed as 
<p>
U(&Omega;) = - k<sub>B</sub> T &Sigma;<sub>L,M,K</sub>&lambda;<sup>L</sup><sub>M,K</sub> D<sup>L</sup><sub>M,K</sub> (&Omega;), 
</p>
where D<sup>L</sup><sub>M,K</sub> are the Wigner D-functions and it is assumed that the terms in the sum are appropriately processed to ensure that the result is always real.
<p>
For example, using a complex number <code>lambda200</code> to represent the coefficient &lambda;<sup>2</sup><sub>0,0</sub> of the commonly used second order Legendre polynomial, set <code>Sys.lambda = [real(lambda200), imag(lambda200)]</code>.
For details about this type of ordering potential, see K.A. Earle & D.E. Budil, Calculating Slow-Motion ESR Spectra of Spin-Labeled Polymers, in: S. Schlick: Advanced ESR Methods in Polymer Research, Wiley, 2006.
</div>

<div class="optionfield"><code>LMK</code></div>
<div class="optiondescr">
An array of size (N,3) containing the indices L,M,K for each orienting potential coefficient in <code>lambda</code>. The resulting orienting potential must be real, so the range of allowed index values are as follows: L&gt;0; if K=0, then 0&lt;M&le;L; and if K&ne;0, then 0&lt;K&le;L and -L&le;M&le;L.
</div>

<div class="optionfield"><code>PseudoPotFun</code></div>
<div class="optiondescr">
A 3D array representing the orienting potential energy function. Dimensions 1, 2, and 3 of this array represent the x, y, and z Cartesian coordinate axes.
</div>


<div class="subtitle2">Input: Simulation parameters</div>


<p>
<code>Par</code> is a structure containing the parameters for calculating the stochastic trajectories. The parameters can be categorized into two groups: Monte Carlo settings and trajectory settings.
<p>
<p>
The Monte Carlo settings specify the parameters used to perform the time integration in the simulation. One can provide an array of time points <code>t</code> along which to integrate, a number of steps <code>nSteps</code> and a time step <code>dt</code>, or a number of steps <code>nSteps</code> and a total time for simulation <code>tmax</code>.

<div class="optionfield"><code>t</code></div>
<div class="optiondescr">
An array of time points along which to integrate, in seconds. If this is provided, no other Monte Carlo settings need to be specified.
</div>

<div class="optionfield"><code>nSteps</code></div>
<div class="optiondescr">
The total number of time steps used to perform integration.
</div>

<div class="optionfield"><code>dt</code></div>
<div class="optiondescr">
The time step of the integration, in seconds.
</div>

<div class="optionfield"><code>tmax</code></div>
<div class="optiondescr">
The total time of the simulation, in seconds.
</div>


<p>
Lastly, the trajectory settings are used to specify the number of trajectories to be simulated, <code>nTraj</code>, and the starting states of each trajectory using <code>Omega</code>.
</p>

<div class="optionfield"><code>Omega</code></div>
<div class="optiondescr">
Used for rotational diffusion. Starting orientations for trajectories, given as an array of size (3,1) or (3,nTraj) containing triplets of the Euler angles &alpha;, &beta;, &gamma;, in radians. If <code>Omega</code> is not provided when simulating rotational diffusion, then a number of starting orientations equal to <code>nTraj</code> will be chosen from a uniform random distribution over the unit sphere, where &alpha;, &beta;, and &gamma; are sampled from [0,2&pi;), [0,&pi;), and [0,2&pi;), respectively.
</div>

<div class="optionfield"><code>nTraj</code></div>
<div class="optiondescr">
The total number of trajectories to simulate.
</div>

<p>
If only one starting orientation is given and <code>nTraj</code> is greater than one, then this starting orientation will be used for each trajectory. If <code>Omega</code> is not provided, then starting orientations will be chosen uniformly at random over the unit 4-sphere. If <code>nTraj</code> is not provided, only one trajectory will be simulated.
</p>

<div class="subtitle2">Input: Simulation options</div>

<p>
<code>Opt</code> is a structure with additional simulation options.
</p>

<div class="optionfield"><code>chkcon</code></div>
<div class="optiondescr">
0 (default), 1<br>
If equal to 1, after the first <code>nSteps</code> of the trajectories are calculated, <code>stochtraj_diffusion</code> will check for both inter- and intra-trajectory convergence using the Gelman-Rubin R statistic (to be specific, requiring that R&lt;1.1, see A. Gelman and D. Rubin, Statistical Science 7, 457 (1992) for details). If convergence is not obtained, then propagation will be extended by either a length of time equal to the average of <code>tcorr</code> or by 20% more time steps, whichever is larger.
</div>
<!--
<div class="optionfield"><code>tol</code></div>
<div class="optiondescr">
Termination tolerance for chi squared in angular distribution. If <code>Par.chkcon=1</code> and <code>tol</code> is not specified, the default value is <code>1e-3</code>.
</div>
-->

<div class="optionfield"><code>Verbosity</code></div>
<div class="optiondescr">
0 (default), 1<br>
Determines how much information <code>stochtraj_diffusion</code> prints to the screen. If <code>Opt.Verbosity=0</code>, it is completely silent. 1 prints details about the progress of the computation.
</div>

<!-- =================================================================== -->
<div class="subtitle">Example</div>

<p>
To simulate a 200-ns long, fast motion Brownian diffusion trajectory starting from the north pole on the unit sphere, enter
</p>

<pre class="matlab">
Sys.tcorr = 5e-9;  % 5 ns rotational correlation time

Par.dt = 1e-9;  % 1 ns time step
Par.nSteps = 1e3;  % 1000 time steps
Par.Omega = [0,0,0];

[t,RTraj] = stochtraj_diffusion(Sys,Par);
</pre>

<p>
To simulate 400 1-&mu;s long, slow motion trajectories in an orienting potential with coefficient &lambda;<sup>2</sup><sub>0,0</sub> = 1, whose starting points are chosen randomly from the uniform distribution on the unit sphere, enter
</p>

<pre class="matlab">
Sys.tcorr = 50e-9;  % 50 ns rotational correlation time
Sys.Potential.lambda = [1,0];  % purely real orienting potential coefficient
Sys.Potential.LMK = [2,0,0];  % L=2, M=K=0

Par.dt = 1e-9;
Par.nSteps = 500;
Par.nTraj = 400;

[t,qTraj] = stochtraj_diffusion(Sys,Par);
</pre>


<!-- =================================================================== -->
<div class="subtitle">Algorithm</div>

<p>
<code>stochtraj_diffusion</code> solves the stochastic rotational Langevin equation by numerically propagating quaternions. The quaternions specify orientations of the body-fixed coordinate frame with respect to the space-fixed frame. Since both isotropic and anisotropic diffusion tensors are diagonal in the body-fixed frame, defining the quaternions in this manner considerably simplifies the problem.
</p>
<p>
For full details of the methods used here, see: 
</p>
D. Sezer, J. H. Freed, and B. Roux, J. Chem. Phys. B 128, 165106 (2008).

<!-- =================================================================== -->
<div class="subtitle">See also</div>
<p>
<a class="esf" href="stochtraj_jump.html">stochtraj_jump</a>, 
<a class="esf" href="cardamom.html">cardamom</a>, 
<a class="esf" href="chili.html">chili</a>
</p>

<hr>
</section>

<footer></footer>

</body>
</html>
