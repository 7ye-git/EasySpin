<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <link rel="icon" href="img/eslogo196.png">
   <link rel="stylesheet" type="text/css" href="style.css">
   <link rel="stylesheet" href="highlight/matlab.css">
   <script src="highlight/highlight.pack.js"></script>
   <script>hljs.initHighlightingOnLoad();</script>
   <title>pulse</title>
</head>

<body>

<header>
<ul>
<li><img src="img/eslogo42.png">
<li class="header-title">EasySpin
<li><a href="index.html">Documentation</a>
<li><a href="references.html">Publications</a>
<li><a href="http://easyspin.org" target="_blank">Website</a>
<li><a href="http://easyspin.org/forum" target="_blank">Forum</a>
</ul>
</header>

<section>

<div class="functitle">pulse</div>

<p>
Calculates pulse shapes and pulse excitation profiles.
</p>


<!-- ============================================================= -->
<div class="subtitle">Syntax</div>

<pre class="matlab">
pulse(Par)
pulse(Par,Opt)
[t,y] = pulse(...)
[t,y,p] = pulse(...)
[t,y,p,modulation] = pulse(...)
</pre>

<!-- ============================================================= -->
<div class="subtitle">Description</div>

<p>
This function calculates pulse shapes and pulse excitation profiles.
</p>

<p>
The output contains the time axis data in <code>t</code> (time in microseconds). <code>y</code> contains the pulse shape data with the in-phase data in the real component and the quadrature data in the imaginary component.
</p>

<p>
If a third output argument is specified, the pulse excitation profile calculated and returned in the structure <code>p</code>:
<ul>
<li><code>p.offsets</code>: axis of frequency offsets (in MHz)
<li><code>p.Mx</code>, <code>p.My</code>, <code>p.Mz</code>: components of the magnetization vector after the pulse, calculate using two-level density matrix dynamics.
</ul>
</p>

<p>
The fourth output argument contains the structure <code>modulation</code> with the calculated modulation functions for the pulse:
<ul>
<li><code>modulation.A</code>: amplitude modulation function (in MHz)
<li><code>modulation.nu</code>: frequency modulation function (in MHz)
<li><code>modulation.phi</code> phase modulation function (in radians)
</ul>
</p>

<p>
If you don't request any output, <code>pulse</code> plots the calculated pulse shape and excitation profile.
</p>

<p>
The possible input arguments to the function are
<ul>
<li><code>Par</code>: structure containing pulse parameter definitions
<li><code>Opt</code>: structure containing options for the calculation
</ul>

<p>
<code>Par</code> is a structure containing all pulse shape parameters and experimental parameters. The available fields are listed below.

<div class="optionfield"><code>tp</code></div>
<div class="optiondescr">
Pulse length, in microseconds.
</div>

<div class="optionfield"><code>TimeStep</code></div>
<div class="optiondescr">
Time step for the definition of the waveform, in microseconds. If this parameter is not defined, it is automatically determined based on the Nyquist sampling criterion and the input pulse parameters.
</div>

<div class="optionfield"><code>Flip</code></div>
<div class="optiondescr">
Pulse flip angle, in radians. This is used to calculate the pulse amplitude. If absent, <code>Par.Flip=pi</code> is used as default.

<p>
The pulse amplitude is calculated from the flip angle as described in Jeschke, G., Pribitzer, S., Doll, A. Coherence Transfer by Passage Pulses in Electron Paramagnetic Resonance Spectroscopy. J. Phys. Chem. B 119, 13570–13582 (2015), DOI: <a href="http://dx.doi.org/10.1021/acs.jpcb.5b02964">10.1021/acs.jpcb.5b02964</a>.
</div>

<div class="optionfield"><code>Amplitude</code></div>
<div class="optiondescr">
Pulse amplitude, in MHz. If<code>Par.Flip</code> is given, <code>Par.Amplitude</code> is ignored.
</div>

<div class="optionfield"><code>CenterFreq</code></div>
<div class="optiondescr">
Pulse center frequency, in MHz (default = 0).
</div>

<div class="optionfield"><code>Phase</code></div>
<div class="optiondescr">
Pulse phase, in radians, e.g. <code>0</code> for +x, <code>pi/2</code> for +y, etc. If not given, it defaults to 0.
</div>


<div class="optionfield"><code>Type</code></div>
<div class="optiondescr">
Pulse shape name in a string structured as 'AM/FM' (or just 'AM'), where AM refers to the amplitude modulation function and FM to the frequency modulation function.

<p>
The available amplitude modulation functions are <code>'rectangular'</code>, <code>'gaussian'</code>, <code>'sinc'</code>, <code>'quartersin'</code>, <code>'sech'</code>, <code>'WURST'</code>. Different AM functions can be multiplied by concatenating the keywords as <code>'AM1*AM2/FM'</code>. The default is <code>'rectangular'</code>.

<p>
The available options for frequency modulation are <code>'none'</code>, <code>'linear'</code>, <code>'tanh'</code>, <code>'BWcompensated'</code>, <code>'uniformQ'</code>. If only an AM keyword is given, the FM function is set to <code>'none'</code>.
</p>
</div>

<p>
Depending on the AM function, additional fields need to be specified:
<ul>
<li><code>'rectangular'</code>
<ul style="list-style-type:none;padding:5px;">
<li>no additional fields are required
</ul>
<li><code>'gaussian'</code>:
<ul style="list-style-type:none;padding:5px;">
<li><code>tFWHM</code> - FWHM, in microseconds
<li><code>trunc</code> - truncation parameter (0 to 1) (alternative to <code>tFWHM</code>)
</ul>
<li><code>'sinc'</code>:
<ul style="list-style-type:none;padding:5px;">
<li><code>zerocross</code> - width between the first zero-crossing points in microseconds
</ul>
<li><code>'sech'</code>
<ul style="list-style-type:none;padding:5px;">
<li><code>beta</code> - dimensionless truncation parameter (used as beta/tp)
<li><code>n</code> - exponent of the secant function argument (default = 1)
</ul>
<li><code>'WURST'</code>
<ul style="list-style-type:none;padding:5px;">
<li><code>nwurst</code> - parameter determining the steepness of the amplitude function
</ul>
<li><code>'quartersin'</code></li>
<ul style="list-style-type:none;padding:5px;">
<li><code>trise</code> - rise time in microseconds for quarter sine weighting at the pulse edges
</ul>
</ul>
</p>

<p>
Also, depending on the FM function, additional fields are required:
<ul>
<li><code>'none'</code>
<ul style="list-style-type:none;padding:5px;">
<li>no additional fields are required
</ul>
<li><code>'linear'</code>
<ul style="list-style-type:none;padding:5px;">
<li><code>BW</code> - frequency sweep width in MHz (the frequency is swept over ±BW/2)
<li><code>SweepDirection</code> - +1 or -1 (+1 default)
</ul>
<li><code>'tanh'</code>
<ul style="list-style-type:none;padding:5px;">
<li><code>BW</code> - frequency sweep width in MHz (the frequency is swept over ±BW/2)
<li><code>beta</code> - dimensionless truncation parameter
<li><code>SweepDirection</code> - +1 or -1 (+1 default)
</ul>
<li><code>'BWcompensated'</code>
<p>The rate of frequency modulation is adapted to compensate for the resonator bandwidth. The compensation is implemented as described in Doll, A., Pribitzer, S., Tschaggelar, R., Jeschke, G., Adiabatic and fast passage ultra-wideband inversion in pulsed EPR, J. Magn. Reson. 230, 27-39 (2013), DOI: <a href="http://dx.doi.org/10.1016/j.jmr.2013.01.002">10.1016/j.jmr.2013.01.002</a>.
<ul style="list-style-type:none;padding:5px;">
<li><code>BW</code> - frequency sweep width in MHz (the frequency is swept over ±BW/2)
<li><code>SweepDirection</code> - +1 or -1 (+1 default)
<li><code>freqaxis</code> - frequency axis in MHz. Also <code>Par.mwFreq</code> needs to be defined.
<li><code>v1</code> - magnitude response function (ideal or experimental)
</ul>
<li><code>'uniformQ'</code>
<p>
The frequency modulation is calculated as the integral of the squared amplitude modulation function (for nth order sech/tanh pulses or in general to obtain offset-independent adiabaticity pulses, see Garwood, M., DelaBarre, L., J. Magn. Reson. 153, 155-177 (2001), DOI: <a href="http://dx.doi.org/10.1006/jmre.2001.2340">10.1006/jmre.2001.2340</a>.

<ul style="list-style-type:none;padding:5px;">
<li><code>BW</code> - frequency sweep width in MHz (the frequency is swept over ±BW/2)
<li><code>SweepDirection</code> - +1 or -1 (+1 default)
</ul>
</ul>

<code>I</code>, <code>Q</code>
<br>
I and Q data describing an arbitrary pulse. The time axis is reconstructed based on <code>Par.tp</code> and the length of the I and Q vectors, all other input parameters (<code>Par.Amplitude</code>, <code>Par.Flip</code>, <code>Par.FreqOffset</code>, <code>Par.Phase</code>, etc.) are ignored.
</div>

<p>
The parameters in the <code>Opt</code> structure define different settings for the calculation. The available fields are given below.

<div class="optionfield"><code>OverSampleFactor</code></div>
<div class="optiondescr">
Oversampling factor for the automatic determination of the time step (default = 10). 
</div>

<div class="optionfield"><code>Detect</code></div>
<div class="optiondescr">
Detection operator for the excitation profile plotting: 'Sz' (default), 'Sy', 'Sx', 'all'.
</div>

<div class="optionfield"><code>Offsets</code></div>
<div class="optiondescr">
Axis of frequency offsets (in MHz) for which to compute the excitation profile (by default the frequency axis is defined over the range of approximatley ±1.5*BW with 201 points).
</div>

<!-- ============================================================= -->
<div class="subtitle">Pulse definitions</div>

<p>
The pulse amplitude, frequency and phase modulation functions are calculated using the following equations.
</p>

<p>
Amplitude modulation functions:
</p>

<ul>

<li><code>'rectangular'</code>:
<div class="eqn">
<img src="eqn/pulse1.png" alt="[eqn]"><!--MATH
\begin{equation*}
A = 1
\end{equation*}
-->
</div>

<li><code>'gaussian'</code>:
<div class="eqn">
<img src="eqn/pulse2.png" alt="[eqn]"><!--MATH
\begin{equation*}
A = \exp{\left(-\frac{4\ln{2}t^2}{FWHM^2}\right)}
\end{equation*}
-->
</div>

<li><code>'sinc'</code>:
<div class="eqn">
<img src="eqn/pulse3.png" alt="[eqn]"><!--MATH
\begin{equation*}
A = \frac{\sin{x}}{x} \qquad \text{with} \qquad x = \frac{2\pi t}{zerocross}
\end{equation*}
-->
</div>

<li><code>'sech'</code>:
<div class="eqn">
<img src="eqn/pulse4.png" alt="[eqn]"><!--MATH
\begin{equation*}
A = \text{sech}\left(\beta 2^{n-1} \left(\frac{t}{t_p}\right)^n\right)
\end{equation*}
-->
</div>

<li><code>'WURST'</code>:
<div class="eqn">
<img src="eqn/pulse5.png" alt="[eqn]"><!--MATH
\begin{equation*}
A = 1 - \left|\sin{\frac{\pi t}{t_p}} \right|^n
\end{equation*}
-->
</div>

<li><code>'quartersin'</code>:
<div class="eqn">
<img src="eqn/pulse6.png" alt="[eqn]"><!--MATH
\begin{eqnarray*}
A = 1 \qquad &\text{for}& \qquad -\frac{t_p}{2} + t_\text{rise} < t < \frac{t_p}{2} - t_\text{rise} \\
A = \sin\frac{\pi \left(t + \frac{t_p}{2}\right)}{2 t_\text{rise}} \qquad &\text{for}& \qquad -\frac{t_p}{2} < t < -\frac{t_p}{2} + t_\text{rise} \\
A = \sin\frac{\pi \left(t - \frac{t_p}{2} + t_\text{rise}\right)}{2 t_\text{rise}} \qquad &\text{for}& \qquad \frac{t_p}{2} - t_\text{rise} < t < \frac{t_p}{2} \\
\end{eqnarray*}
-->
</div>

</ul>

<p>
Frequency and phase modulation functions:
</p>

<ul>

<li><code>'none'</code>:
<div class="eqn">
<img src="eqn/pulse7.png" alt="[eqn]"><!--MATH
\begin{equation*}
\nu = 0 \qquad \qquad \phi = 0
\end{equation*}
-->
</div>

<li><code>'linear'</code>:
<div class="eqn">
<img src="eqn/pulse8.png" alt="[eqn]"><!--MATH
\begin{equation*}
\nu = \frac{BW}{t_p} t \qquad \qquad \phi = 2 \pi \left( -\frac{BW}{2}\left(t - \frac{t_p}{2}\right) + \frac{1}{2} \frac{BW}{t_p} \left(t - \frac{t_p}{2}\right)^2\right)
\end{equation*}
-->
</div>

<li><code>'BWcompensated'</code>:
<p>
The frequency modulation function is calculated as for the linear chirp and then adjusted to compensate for the resonator profile (see Doll, A., Pribitzer, S., Tschaggelar, R., Jeschke, G., Adiabatic and fast passage ultra-wideband inversion in pulsed EPR, J. Magn. Reson. 230, 27-39 (2013), DOI: <a href="http://dx.doi.org/10.1016/j.jmr.2013.01.002">10.1016/j.jmr.2013.01.002</a>). The phase modulation function is obtained by integration and the phase is set to zero at the center of the pulse.
<p/>

<li><code>'tanh'</code>:
<div class="eqn">
<img src="eqn/pulse9.png" alt="[eqn]"><!--MATH
\begin{equation*}
\nu = \frac{BW}{2 \tanh{\frac{\beta}{2}}} \tanh{\frac{\beta t}{t_p}} \qquad \qquad \phi = 2 \pi \frac{BW}{2 \tanh{\frac{\beta}{2}}} \frac{t_p}{\beta} \log\left[\cosh{\frac{\beta t}{t_p}}\right]
\end{equation*}-->
</div>

<li><code>'uniformQ'</code>:
<p>
The frequency modulation function is calculated as the integral of the squared amplitude modulation function and multiplied by the specified bandwidth (centered at zero). This can be used for nth order sech pulses or in general to obtain offset-independent adiabaticity pulses given a certain amplitude function (see Garwood, M., DelaBarre, L., J. Magn. Reson. 153, 155-177 (2001), DOI: <a href="http://dx.doi.org/10.1006/jmre.2001.2340">10.1006/jmre.2001.2340</a>). The phase modulation function is obtained by integration and the phase is set to zero at the center of the pulse.
<p/>

</ul>

<p>
The time axis for the calculation of the modulation functions is centered at zero. The normalized amplitude modulation functions given above are multiplied by <code>Par.Amplitude</code>.
</p>

<p>
The final pulse shape is calculated as:
</p>
<div class="eqn">
<img src="eqn/pulse10.png" alt="[eqn]"><!--MATH
\begin{equation*}
\begin{equation*}
P = A \exp\left[i \left(\phi + 2 \pi \nu_\text{center} + \Delta\phi\right) \right]
\end{equation*}
-->
</div>
<p>
where the different terms are the amplitude modulation, the phase modulation, the center frequency defined in <code>Par.CenterFreq</code> and the phase offset defined in <code>Par.Phase</code>.
</p>





<!-- ============================================================= -->
<div class="subtitle">See also</div>

<p>
<a class="esf" href="evolve.html">evolve</a>,
<a class="esf" href="saffron.html">saffron</a>
</p>

<hr>
</section>

<footer></footer>

</body>

</html>
